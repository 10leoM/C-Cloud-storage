清单
路由接入与工程骨架
认证与会话（内存版）
大文件上传（分块/断点续传）
断点下载（Range/ETag/HEAD）
文件列表/删除与基础分享
持久化替换（SQLite/MySQL）
安全与一致性收尾
验收与文档
开发路线
1) 路由接入与工程骨架（当天）
位置：新建 app/ 目录（不动 WebMem）
app/auth/, app/files/, app/share/, app/common/SessionManager.{h,cpp}
在启动处注册路由与处理器（用已有 AddRoute/RegisterHandler/DispatchByRouter）。
验收：curl 命中路由返回 200/404，参数解析正常。
2) 认证与会话（内存版，0.5 天）
路由：
POST /api/register，POST /api/login，POST /api/logout
实现：
简单用户表（内存 map），密码哈希（std::hash 先占位）。
SessionManager：生成 sid、内存保存 userId/过期时间；Header 或 Cookie 传递。
中间件：
受保护路由先校验 session（或在回调开头统一校验）。
验收：注册→登录→带 sid 访问受保护路由成功；未登录返回 401。
3) 大文件上传（分块断点，1 天）
路由（建议分三步，适配当前“请求完成后回调”模型）：
POST /api/upload/init → 返回 uploadId
POST /api/upload/part → Header: Upload-Id, Content-Range；落盘到临时文件；记录 offset/etag
POST /api/upload/complete → 原子 rename，生成元信息
状态存储：内存 map<uploadId, {path, offset, etag}>（先行）。
约束：大小限制、白名单后缀、路径清洗。
验收：断网/中断后续传，再次带 Content-Range 继续上传成功。
4) 断点下载（Range/HEAD/ETag，0.5~1 天）
路由：GET/HEAD /api/download/:name
响应：Accept-Ranges、ETag/Last-Modified、Content-Disposition，206/200。
逻辑：解析 Range→单区间返回→HEAD 不发主体→条件请求 If-Range/If-None-Match（先做 ETag）。
验收：curl -H "Range: bytes=..." 返回 206，浏览器断点拖动正常。
5) 文件列表/删除与基础分享（1 天）
路由：
GET /api/files（仅本人）
DELETE /api/files/:name
POST /api/share/:name → 生成 share token（短期有效）
GET /share/:token → 校验后返回文件信息或下载跳转
元数据：内存表保存 owner, name, size, type, ctime。
权限：删除需 owner；分享 token 校验有效期与目标文件。
验收：登录→上传→列表→下载→分享→分享链接访问成功。
6) 持久化替换（1.5 天）
将内存数据迁移到 SQLite（或 MySQL）：
users, sessions, files, shares 四表
抽 DAO 层，保证接口稳定；保留内存实现用于本地/单测。
验收：冷启动后数据可留存；并发访问正常。
7) 安全与一致性收尾（0.5 天）
405 与 404 区分；统一 JSON 响应与错误码。
上传/下载速率与大小限制；文件名/路径清洗；MIME 设置正确。
访问日志与关键点告警日志。
8) 验收与文档（0.5 天）
最小 e2e 流程脚本：注册→登录→分块上传→列表→Range 下载→分享访问。
README：路由清单、配置项、已知限制。